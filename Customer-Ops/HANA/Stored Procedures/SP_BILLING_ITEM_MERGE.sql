CREATE PROC [HANA].[SP_BILLING_ITEM_MERGE] AS
BEGIN
MERGE [HANA].[BILLING_ITEM] AS tgt
USING [HANA].[BILLING_ITEM_DELTA] AS src
ON src.BILL_ITEM_COMP_KEY = tgt.BILL_ITEM_COMP_KEY

WHEN MATCHED THEN
    UPDATE SET tgt.BILLING_DOC_NO=src.BILLING_DOC_NO,
tgt.SALES_DOC_CATEGORY_CODE=src.SALES_DOC_CATEGORY_CODE,
tgt.SHIPPING_CONDITIONS_CODE=src.SHIPPING_CONDITIONS_CODE,
tgt.SALES_DOC_CURRENCY_CODE=src.SALES_DOC_CURRENCY_CODE,
tgt.PAYMENT_METHOD_CODE=src.PAYMENT_METHOD_CODE,
tgt.PAYMENT_TERMS_CODE=src.PAYMENT_TERMS_CODE,
tgt.BILLING_HEADER_LAST_CHANGE_DATE=src.BILLING_HEADER_LAST_CHANGE_DATE,
tgt.COMPANY_CODE=src.COMPANY_CODE,
tgt.BILLING_HEADER_RECORD_CREATE_DATE=src.BILLING_HEADER_RECORD_CREATE_DATE,
tgt.BILLING_HEADER_RECORD_CREATE_BY=src.BILLING_HEADER_RECORD_CREATE_BY,
tgt.BILLING_TYPE_CODE=src.BILLING_TYPE_CODE,
tgt.BILLING_DATE=src.BILLING_DATE,
tgt.BILLING_CATEGORY_CODE=src.BILLING_CATEGORY_CODE,
tgt.DOC_CONDITION_NO=src.DOC_CONDITION_NO,
tgt.ACCOUNT_ASSIGNMENT_GROUP_CODE=src.ACCOUNT_ASSIGNMENT_GROUP_CODE,
tgt.SOLD_TO_PARTY_CODE=src.SOLD_TO_PARTY_CODE,
tgt.PAYER_CODE=src.PAYER_CODE,
tgt.REF_SALES_DOC_NO=src.REF_SALES_DOC_NO,
tgt.SALES_DOC_ITEM_NO=src.SALES_DOC_ITEM_NO,
tgt.ORDER_REASON_CODE=src.ORDER_REASON_CODE,
tgt.SALES_DOC_NO=src.SALES_DOC_NO,
tgt.WEIGHT_UOM=src.WEIGHT_UOM,
tgt.CONDITION_UPDATE_CODE=src.CONDITION_UPDATE_CODE,
tgt.MATERIAL_PRICING_GROUP_CODE=src.MATERIAL_PRICING_GROUP_CODE,
tgt.BILLING_ITEM_BUOM=src.BILLING_ITEM_BUOM,
tgt.MATERIAL_NO_ENTERED=src.MATERIAL_NO_ENTERED,
tgt.MATERIAL_NO=src.MATERIAL_NO,
tgt.MATERIAL_GROUP_CODE=src.MATERIAL_GROUP_CODE,
tgt.PRICING_EXCHANGE_RATE_DATE=src.PRICING_EXCHANGE_RATE_DATE,
tgt.PRODUCT_HIERARCHY=src.PRODUCT_HIERARCHY,
tgt.PARTNER_SEGMENT_ITEM_NO=src.PARTNER_SEGMENT_ITEM_NO,
tgt.ORIGINAL_DOC_ITEM_NO=src.ORIGINAL_DOC_ITEM_NO,
tgt.BILLING_DOC_ITEM_CODE=src.BILLING_DOC_ITEM_CODE,
tgt.SALES_ORDER_PRICE_LIST_TYPE_CODE=src.SALES_ORDER_PRICE_LIST_TYPE_CODE,
tgt.DIVISION_CODE=src.DIVISION_CODE,
tgt.PLANT_CODE=src.PLANT_CODE,
tgt.SALES_ORDER_DISTRIBUTION_CHANNEL=src.SALES_ORDER_DISTRIBUTION_CHANNEL,
tgt.SHIPPING_POINT_CODE=src.SHIPPING_POINT_CODE,
tgt.SALES_UNIT=src.SALES_UNIT,
tgt.VOL_UOM=src.VOL_UOM,
tgt.SALES_GROUP_CODE=src.SALES_GROUP_CODE,
tgt.SALES_OFFICE_CODE=src.SALES_OFFICE_CODE,
tgt.COST_IN_DC=src.COST_IN_DC,
tgt.BILLING_ITEM_NET_VALUE=src.BILLING_ITEM_NET_VALUE,
tgt.PRICE_DETERMINATION_EXCHANGE_RATE=src.PRICE_DETERMINATION_EXCHANGE_RATE,
tgt.BILLING_ITEM_VOL=src.BILLING_ITEM_VOL,
tgt.GROSS_WEIGHT=src.GROSS_WEIGHT,
tgt.NET_WEIGHT=src.NET_WEIGHT,
tgt.REQ_QTY_IN_SKU=src.REQ_QTY_IN_SKU,
tgt.BILLING_QTY_IN_SKU=src.BILLING_QTY_IN_SKU,
tgt.ACTUAL_BILLED_QTY=src.ACTUAL_BILLED_QTY,
tgt.DISTRIBUTION_CHANNEL_CODE=src.DISTRIBUTION_CHANNEL_CODE,
tgt.SALES_ORG_CODE=src.SALES_ORG_CODE,
tgt.SOLD_TO_PARTY_NAME=src.SOLD_TO_PARTY_NAME,
tgt.BILLING_HEADER_DIVISION_CODE=src.BILLING_HEADER_DIVISION_CODE,
tgt.BILLING_ITEM_RECORD_CREATE_DATE=src.BILLING_ITEM_RECORD_CREATE_DATE,
tgt.BILLING_HEADER_REF_DOC_NO=src.BILLING_HEADER_REF_DOC_NO,
tgt.BILLING_DOC_CANCEL_CODE=src.BILLING_DOC_CANCEL_CODE,
tgt.CUSTOMER_GROUP_CODE=src.CUSTOMER_GROUP_CODE,
tgt.CUSTOMER_PRICE_GROUP_CODE=src.CUSTOMER_PRICE_GROUP_CODE,
tgt.DELIVERY_REF_DOC_NO=src.DELIVERY_REF_DOC_NO,
tgt.DELIVERY_REF_DOC_ITEM_NO=src.DELIVERY_REF_DOC_ITEM_NO,
tgt.BILL_REUSABLE_LAST_DTM=src.BILL_REUSABLE_LAST_DTM,
tgt.ITEMS_OVERALL_DELIVERY_STATUS_CODE=src.ITEMS_OVERALL_DELIVERY_STATUS_CODE,
tgt.OVERALL_PICKING_STATUS=src.OVERALL_PICKING_STATUS,
tgt.OVERALL_PROCESSING_STATUS_CODE=src.OVERALL_PROCESSING_STATUS_CODE,
tgt.OVERALL_BILLING_BLOCK_STATUS_CODE=src.OVERALL_BILLING_BLOCK_STATUS_CODE,
tgt.BILLING_DOCUMENT_STATUS_CODE=src.BILLING_DOCUMENT_STATUS_CODE,
tgt.OVERALL_BLOCKED_STATUS_CODE=src.OVERALL_BLOCKED_STATUS_CODE,
tgt.ITEMS_OVERALL_PACKING_STATUS_CODE=src.ITEMS_OVERALL_PACKING_STATUS_CODE,
tgt.SALES_DOC_HEADER_POD_STATUS_CODE=src.SALES_DOC_HEADER_POD_STATUS_CODE,
tgt.OVERALL_DELIVERY_BLOCK_STATUS_CODE=src.OVERALL_DELIVERY_BLOCK_STATUS_CODE,
tgt.OVERALL_CREDIT_STATUS_CODE=src.OVERALL_CREDIT_STATUS_CODE,
tgt.ITEMS_OVERALL_REJECTION_STATUS_CODE=src.ITEMS_OVERALL_REJECTION_STATUS_CODE,
tgt.SALES_DOC_BILLING_STATUS_CODE=src.SALES_DOC_BILLING_STATUS_CODE,
tgt.DELIVERY_STATUS_CODE=src.DELIVERY_STATUS_CODE,
tgt.ITEM_REJECTION_STATUS_CODE=src.ITEM_REJECTION_STATUS_CODE,
tgt.ITEM_OVERALL_DELIVERY_STATUS_CODE=src.ITEM_OVERALL_DELIVERY_STATUS_CODE,
tgt.ITEM_DELIVERY_STATUS_CODE=src.ITEM_DELIVERY_STATUS_CODE,
tgt.ITEM_BILLING_BLOCK_STATUS_CODE=src.ITEM_BILLING_BLOCK_STATUS_CODE,
tgt.REF_OVERALL_STATUS_CODE=src.REF_OVERALL_STATUS_CODE,
tgt.ITEM_POD_STATUS_CODE=src.ITEM_POD_STATUS_CODE,
tgt.EXTERNAL_BILL_OF_LADING=src.EXTERNAL_BILL_OF_LADING,
tgt.MATERIAL_ACCOUNT_ASSIGNMENT_GROUP_CODE=src.MATERIAL_ACCOUNT_ASSIGNMENT_GROUP_CODE,
tgt.MAIN_ITEM_MATERIAL_PRICING_GROUP=src.MAIN_ITEM_MATERIAL_PRICING_GROUP,
tgt.CUSTOMER_CONDITION_GROUP1_CODE=src.CUSTOMER_CONDITION_GROUP1_CODE,
tgt.INCOTERM_CODE=src.INCOTERM_CODE,
tgt.INCOTERM_DESTINATION_NAME=src.INCOTERM_DESTINATION_NAME,
tgt.PAYMENT_REF_CODE=src.PAYMENT_REF_CODE,
tgt.CREDIT_CONTROL_AREA_CODE=src.CREDIT_CONTROL_AREA_CODE,
tgt.CANCELLED_BILLING_DOC_NO=src.CANCELLED_BILLING_DOC_NO,
tgt.SHIP_TO_PARTY=src.SHIP_TO_PARTY,
tgt.BILL_TO_PARTY=src.BILL_TO_PARTY,
tgt.PAYMENT_TERM_DESC=src.PAYMENT_TERM_DESC,
tgt.SHIPPING_CONDITION_DESC=src.SHIPPING_CONDITION_DESC,
tgt.SALES_ORGANISATION_NAME=src.SALES_ORGANISATION_NAME,
tgt.CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC=src.CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC,
tgt.DIVISION_NAME=src.DIVISION_NAME,
tgt.BILLING_DOC_TYPE_DESC=src.BILLING_DOC_TYPE_DESC,
tgt.SALES_GROUP_DESC=src.SALES_GROUP_DESC,
tgt.SALES_OFFICE_DESC=src.SALES_OFFICE_DESC,
tgt.PLANT_NAME=src.PLANT_NAME,
tgt.CREDIT_CONTROL_AREA_DESC=src.CREDIT_CONTROL_AREA_DESC,
tgt.MATERIAL_GROUP_DESC=src.MATERIAL_GROUP_DESC,
tgt.PAYMENT_METHOD_DESC=src.PAYMENT_METHOD_DESC,
tgt.MATERIAL_PRICING_GROUP_DESC=src.MATERIAL_PRICING_GROUP_DESC,
tgt.MATERIAL_DESC=src.MATERIAL_DESC,
tgt.DISTRIBUTION_CHANNEL_NAME=src.DISTRIBUTION_CHANNEL_NAME,
tgt.PAYER_NAME=src.PAYER_NAME,
tgt.SHIP_TO_PARTY_NAME=src.SHIP_TO_PARTY_NAME,
tgt.BILL_TO_PARTY_NAME=src.BILL_TO_PARTY_NAME,
tgt.CUSTOMER_CONDITION_GROUP_DESC=src.CUSTOMER_CONDITION_GROUP_DESC

WHEN NOT MATCHED THEN
INSERT (BILLING_DOC_NO,SALES_DOC_CATEGORY_CODE,SHIPPING_CONDITIONS_CODE,SALES_DOC_CURRENCY_CODE,PAYMENT_METHOD_CODE,PAYMENT_TERMS_CODE,BILLING_HEADER_LAST_CHANGE_DATE,COMPANY_CODE,BILLING_HEADER_RECORD_CREATE_DATE,BILLING_HEADER_RECORD_CREATE_BY,BILLING_TYPE_CODE,BILLING_DATE,BILLING_CATEGORY_CODE,DOC_CONDITION_NO,ACCOUNT_ASSIGNMENT_GROUP_CODE,SOLD_TO_PARTY_CODE,PAYER_CODE,REF_SALES_DOC_NO,SALES_DOC_ITEM_NO,ORDER_REASON_CODE,SALES_DOC_NO,WEIGHT_UOM,CONDITION_UPDATE_CODE,MATERIAL_PRICING_GROUP_CODE,BILLING_ITEM_BUOM,MATERIAL_NO_ENTERED,MATERIAL_NO,MATERIAL_GROUP_CODE,PRICING_EXCHANGE_RATE_DATE,PRODUCT_HIERARCHY,PARTNER_SEGMENT_ITEM_NO,ORIGINAL_DOC_ITEM_NO,BILLING_DOC_ITEM_CODE,SALES_ORDER_PRICE_LIST_TYPE_CODE,DIVISION_CODE,PLANT_CODE,SALES_ORDER_DISTRIBUTION_CHANNEL,SHIPPING_POINT_CODE,SALES_UNIT,VOL_UOM,SALES_GROUP_CODE,SALES_OFFICE_CODE,COST_IN_DC,BILLING_ITEM_NET_VALUE,PRICE_DETERMINATION_EXCHANGE_RATE,BILLING_ITEM_VOL,GROSS_WEIGHT,NET_WEIGHT,REQ_QTY_IN_SKU,BILLING_QTY_IN_SKU,ACTUAL_BILLED_QTY,DISTRIBUTION_CHANNEL_CODE,SALES_ORG_CODE,SOLD_TO_PARTY_NAME,BILLING_HEADER_DIVISION_CODE,BILLING_ITEM_RECORD_CREATE_DATE,BILLING_HEADER_REF_DOC_NO,BILLING_DOC_CANCEL_CODE,CUSTOMER_GROUP_CODE,CUSTOMER_PRICE_GROUP_CODE,DELIVERY_REF_DOC_NO,DELIVERY_REF_DOC_ITEM_NO,BILL_REUSABLE_LAST_DTM,ITEMS_OVERALL_DELIVERY_STATUS_CODE,OVERALL_PICKING_STATUS,OVERALL_PROCESSING_STATUS_CODE,OVERALL_BILLING_BLOCK_STATUS_CODE,BILLING_DOCUMENT_STATUS_CODE,OVERALL_BLOCKED_STATUS_CODE,ITEMS_OVERALL_PACKING_STATUS_CODE,SALES_DOC_HEADER_POD_STATUS_CODE,OVERALL_DELIVERY_BLOCK_STATUS_CODE,OVERALL_CREDIT_STATUS_CODE,ITEMS_OVERALL_REJECTION_STATUS_CODE,SALES_DOC_BILLING_STATUS_CODE,DELIVERY_STATUS_CODE,ITEM_REJECTION_STATUS_CODE,ITEM_OVERALL_DELIVERY_STATUS_CODE,ITEM_DELIVERY_STATUS_CODE,ITEM_BILLING_BLOCK_STATUS_CODE,REF_OVERALL_STATUS_CODE,ITEM_POD_STATUS_CODE,EXTERNAL_BILL_OF_LADING,MATERIAL_ACCOUNT_ASSIGNMENT_GROUP_CODE,MAIN_ITEM_MATERIAL_PRICING_GROUP,CUSTOMER_CONDITION_GROUP1_CODE,INCOTERM_CODE,INCOTERM_DESTINATION_NAME,PAYMENT_REF_CODE,CREDIT_CONTROL_AREA_CODE,CANCELLED_BILLING_DOC_NO,SHIP_TO_PARTY,BILL_TO_PARTY,PAYMENT_TERM_DESC,SHIPPING_CONDITION_DESC,SALES_ORGANISATION_NAME,CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC,DIVISION_NAME,BILLING_DOC_TYPE_DESC,SALES_GROUP_DESC,SALES_OFFICE_DESC,PLANT_NAME,CREDIT_CONTROL_AREA_DESC,MATERIAL_GROUP_DESC,PAYMENT_METHOD_DESC,MATERIAL_PRICING_GROUP_DESC,MATERIAL_DESC,DISTRIBUTION_CHANNEL_NAME,PAYER_NAME,SHIP_TO_PARTY_NAME,BILL_TO_PARTY_NAME,CUSTOMER_CONDITION_GROUP_DESC,BILL_ITEM_COMP_KEY)
VALUES (src.BILLING_DOC_NO,src.SALES_DOC_CATEGORY_CODE,src.SHIPPING_CONDITIONS_CODE,src.SALES_DOC_CURRENCY_CODE,src.PAYMENT_METHOD_CODE,src.PAYMENT_TERMS_CODE,src.BILLING_HEADER_LAST_CHANGE_DATE,src.COMPANY_CODE,src.BILLING_HEADER_RECORD_CREATE_DATE,src.BILLING_HEADER_RECORD_CREATE_BY,src.BILLING_TYPE_CODE,src.BILLING_DATE,src.BILLING_CATEGORY_CODE,src.DOC_CONDITION_NO,src.ACCOUNT_ASSIGNMENT_GROUP_CODE,src.SOLD_TO_PARTY_CODE,src.PAYER_CODE,src.REF_SALES_DOC_NO,src.SALES_DOC_ITEM_NO,src.ORDER_REASON_CODE,src.SALES_DOC_NO,src.WEIGHT_UOM,src.CONDITION_UPDATE_CODE,src.MATERIAL_PRICING_GROUP_CODE,src.BILLING_ITEM_BUOM,src.MATERIAL_NO_ENTERED,src.MATERIAL_NO,src.MATERIAL_GROUP_CODE,src.PRICING_EXCHANGE_RATE_DATE,src.PRODUCT_HIERARCHY,src.PARTNER_SEGMENT_ITEM_NO,src.ORIGINAL_DOC_ITEM_NO,src.BILLING_DOC_ITEM_CODE,src.SALES_ORDER_PRICE_LIST_TYPE_CODE,src.DIVISION_CODE,src.PLANT_CODE,src.SALES_ORDER_DISTRIBUTION_CHANNEL,src.SHIPPING_POINT_CODE,src.SALES_UNIT,src.VOL_UOM,src.SALES_GROUP_CODE,src.SALES_OFFICE_CODE,src.COST_IN_DC,src.BILLING_ITEM_NET_VALUE,src.PRICE_DETERMINATION_EXCHANGE_RATE,src.BILLING_ITEM_VOL,src.GROSS_WEIGHT,src.NET_WEIGHT,src.REQ_QTY_IN_SKU,src.BILLING_QTY_IN_SKU,src.ACTUAL_BILLED_QTY,src.DISTRIBUTION_CHANNEL_CODE,src.SALES_ORG_CODE,src.SOLD_TO_PARTY_NAME,src.BILLING_HEADER_DIVISION_CODE,src.BILLING_ITEM_RECORD_CREATE_DATE,src.BILLING_HEADER_REF_DOC_NO,src.BILLING_DOC_CANCEL_CODE,src.CUSTOMER_GROUP_CODE,src.CUSTOMER_PRICE_GROUP_CODE,src.DELIVERY_REF_DOC_NO,src.DELIVERY_REF_DOC_ITEM_NO,src.BILL_REUSABLE_LAST_DTM,src.ITEMS_OVERALL_DELIVERY_STATUS_CODE,src.OVERALL_PICKING_STATUS,src.OVERALL_PROCESSING_STATUS_CODE,src.OVERALL_BILLING_BLOCK_STATUS_CODE,src.BILLING_DOCUMENT_STATUS_CODE,src.OVERALL_BLOCKED_STATUS_CODE,src.ITEMS_OVERALL_PACKING_STATUS_CODE,src.SALES_DOC_HEADER_POD_STATUS_CODE,src.OVERALL_DELIVERY_BLOCK_STATUS_CODE,src.OVERALL_CREDIT_STATUS_CODE,src.ITEMS_OVERALL_REJECTION_STATUS_CODE,src.SALES_DOC_BILLING_STATUS_CODE,src.DELIVERY_STATUS_CODE,src.ITEM_REJECTION_STATUS_CODE,src.ITEM_OVERALL_DELIVERY_STATUS_CODE,src.ITEM_DELIVERY_STATUS_CODE,src.ITEM_BILLING_BLOCK_STATUS_CODE,src.REF_OVERALL_STATUS_CODE,src.ITEM_POD_STATUS_CODE,src.EXTERNAL_BILL_OF_LADING,src.MATERIAL_ACCOUNT_ASSIGNMENT_GROUP_CODE,src.MAIN_ITEM_MATERIAL_PRICING_GROUP,src.CUSTOMER_CONDITION_GROUP1_CODE,src.INCOTERM_CODE,src.INCOTERM_DESTINATION_NAME,src.PAYMENT_REF_CODE,src.CREDIT_CONTROL_AREA_CODE,src.CANCELLED_BILLING_DOC_NO,src.SHIP_TO_PARTY,src.BILL_TO_PARTY,src.PAYMENT_TERM_DESC,src.SHIPPING_CONDITION_DESC,src.SALES_ORGANISATION_NAME,src.CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC,src.DIVISION_NAME,src.BILLING_DOC_TYPE_DESC,src.SALES_GROUP_DESC,src.SALES_OFFICE_DESC,src.PLANT_NAME,src.CREDIT_CONTROL_AREA_DESC,src.MATERIAL_GROUP_DESC,src.PAYMENT_METHOD_DESC,src.MATERIAL_PRICING_GROUP_DESC,src.MATERIAL_DESC,src.DISTRIBUTION_CHANNEL_NAME,src.PAYER_NAME,src.SHIP_TO_PARTY_NAME,src.BILL_TO_PARTY_NAME,src.CUSTOMER_CONDITION_GROUP_DESC,src.BILL_ITEM_COMP_KEY);
END
