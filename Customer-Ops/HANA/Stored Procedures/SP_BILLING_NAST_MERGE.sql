CREATE PROC [HANA].[SP_BILLING_NAST_MERGE] AS
BEGIN
MERGE [HANA].[BILLING_NAST] AS tgt
USING [HANA].[BILLING_NAST_DELTA] AS src
ON src.BILL_ITEM_COMP_KEY = tgt.BILL_ITEM_COMP_KEY

WHEN MATCHED THEN
    UPDATE SET tgt.BILLING_DOC_NO=src.BILLING_DOC_NO,
tgt.SALES_DOC_CATEGORY_CODE=src.SALES_DOC_CATEGORY_CODE,
tgt.SHIPPING_CONDITIONS_CODE=src.SHIPPING_CONDITIONS_CODE,
tgt.SALES_DOC_CURRENCY_CODE=src.SALES_DOC_CURRENCY_CODE,
tgt.PAYMENT_METHOD_CODE=src.PAYMENT_METHOD_CODE,
tgt.PAYMENT_TERMS_CODE=src.PAYMENT_TERMS_CODE,
tgt.BILLING_HEADER_LAST_CHANGE_DATE=src.BILLING_HEADER_LAST_CHANGE_DATE,
tgt.COMPANY_CODE=src.COMPANY_CODE,
tgt.BILLING_HEADER_RECORD_CREATE_DATE=src.BILLING_HEADER_RECORD_CREATE_DATE,
tgt.BILLING_HEADER_RECORD_CREATE_BY=src.BILLING_HEADER_RECORD_CREATE_BY,
tgt.BILLING_TYPE_CODE=src.BILLING_TYPE_CODE,
tgt.BILLING_DATE=src.BILLING_DATE,
tgt.BILLING_CATEGORY_CODE=src.BILLING_CATEGORY_CODE,
tgt.DOC_CONDITION_NO=src.DOC_CONDITION_NO,
tgt.ACCOUNT_ASSIGNMENT_GROUP_CODE=src.ACCOUNT_ASSIGNMENT_GROUP_CODE,
tgt.SOLD_TO_PARTY_CODE=src.SOLD_TO_PARTY_CODE,
tgt.PAYER_CODE=src.PAYER_CODE,
tgt.DISTRIBUTION_CHANNEL_CODE=src.DISTRIBUTION_CHANNEL_CODE,
tgt.SALES_ORG_CODE=src.SALES_ORG_CODE,
tgt.SOLD_TO_PARTY_NAME=src.SOLD_TO_PARTY_NAME,
tgt.BILLING_HEADER_DIVISION_CODE=src.BILLING_HEADER_DIVISION_CODE,
tgt.BILLING_HEADER_REF_DOC_NO=src.BILLING_HEADER_REF_DOC_NO,
tgt.BILLING_DOC_CANCEL_CODE=src.BILLING_DOC_CANCEL_CODE,
tgt.CUSTOMER_GROUP_CODE=src.CUSTOMER_GROUP_CODE,
tgt.CUSTOMER_PRICE_GROUP_CODE=src.CUSTOMER_PRICE_GROUP_CODE,
tgt.SHIP_TO_PARTY=src.SHIP_TO_PARTY,
tgt.BILL_TO_PARTY=src.BILL_TO_PARTY,
tgt.SHIP_TO_PARTY_NAME=src.SHIP_TO_PARTY_NAME,
tgt.BILL_TO_PARTY_NAME=src.BILL_TO_PARTY_NAME,
tgt.PAYER_NAME=src.PAYER_NAME,
tgt.CREDIT_CONTROL_AREA_DESC=src.CREDIT_CONTROL_AREA_DESC,
tgt.PAYMENT_METHOD_DESC=src.PAYMENT_METHOD_DESC,
tgt.DIVISION_NAME=src.DIVISION_NAME,
tgt.BILLING_DOC_TYPE_DESC=src.BILLING_DOC_TYPE_DESC,
tgt.SALES_ORGANISATION_NAME=src.SALES_ORGANISATION_NAME,
tgt.CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC=src.CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC,
tgt.SHIPPING_CONDITION_DESC=src.SHIPPING_CONDITION_DESC,
tgt.DISTRIBUTION_CHANNEL_NAME=src.DISTRIBUTION_CHANNEL_NAME,
tgt.PAYMENT_TERM_DESC=src.PAYMENT_TERM_DESC,
tgt.INCOTERM_CODE=src.INCOTERM_CODE,
tgt.INCOTERM_DESTINATION_NAME=src.INCOTERM_DESTINATION_NAME,
tgt.PAYMENT_REF_CODE=src.PAYMENT_REF_CODE,
tgt.CREDIT_CONTROL_AREA_CODE=src.CREDIT_CONTROL_AREA_CODE,
tgt.CANCELLED_BILLING_DOC_NO=src.CANCELLED_BILLING_DOC_NO,
tgt.MESSAGE_ACTIVE_IND=src.MESSAGE_ACTIVE_IND,
tgt.MESSAGE_TYPE_CODE=src.MESSAGE_TYPE_CODE,
tgt.MESSAGE_TRANSMISSION_MEDIUM_CODE=src.MESSAGE_TRANSMISSION_MEDIUM_CODE,
tgt.MESSAGE_STATUS_PRINT_ARCHIVING_MODE_CODE=src.MESSAGE_STATUS_PRINT_ARCHIVING_MODE_CODE,
tgt.OBJECT_KEY=src.OBJECT_KEY,
tgt.MESSAGE_PARTNER_CODE=src.MESSAGE_PARTNER_CODE,
tgt.MESSAGE_STATUS_SPOOL_OUTPUT_DEVICE_CODE=src.MESSAGE_STATUS_SPOOL_OUTPUT_DEVICE_CODE,
tgt.MESSAGE_STATUS_SPOOL_REQUEST_NAME=src.MESSAGE_STATUS_SPOOL_REQUEST_NAME,
tgt.CONDITION_TYPE_NAME=src.CONDITION_TYPE_NAME,
tgt.BILL_REUSABLE_LAST_DTM=src.BILL_REUSABLE_LAST_DTM,
tgt.BILL_NAST_COMP_KEY=src.BILL_NAST_COMP_KEY

WHEN NOT MATCHED THEN
INSERT (BILLING_DOC_NO,SALES_DOC_CATEGORY_CODE,SHIPPING_CONDITIONS_CODE,SALES_DOC_CURRENCY_CODE,PAYMENT_METHOD_CODE,PAYMENT_TERMS_CODE,BILLING_HEADER_LAST_CHANGE_DATE,COMPANY_CODE,BILLING_HEADER_RECORD_CREATE_DATE,BILLING_HEADER_RECORD_CREATE_BY,BILLING_TYPE_CODE,BILLING_DATE,BILLING_CATEGORY_CODE,DOC_CONDITION_NO,ACCOUNT_ASSIGNMENT_GROUP_CODE,SOLD_TO_PARTY_CODE,PAYER_CODE,DISTRIBUTION_CHANNEL_CODE,SALES_ORG_CODE,SOLD_TO_PARTY_NAME,BILLING_HEADER_DIVISION_CODE,BILLING_HEADER_REF_DOC_NO,BILLING_DOC_CANCEL_CODE,CUSTOMER_GROUP_CODE,CUSTOMER_PRICE_GROUP_CODE,SHIP_TO_PARTY,BILL_TO_PARTY,SHIP_TO_PARTY_NAME,BILL_TO_PARTY_NAME,PAYER_NAME,CREDIT_CONTROL_AREA_DESC,PAYMENT_METHOD_DESC,DIVISION_NAME,BILLING_DOC_TYPE_DESC,SALES_ORGANISATION_NAME,CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC,SHIPPING_CONDITION_DESC,DISTRIBUTION_CHANNEL_NAME,PAYMENT_TERM_DESC,INCOTERM_CODE,INCOTERM_DESTINATION_NAME,PAYMENT_REF_CODE,CREDIT_CONTROL_AREA_CODE,CANCELLED_BILLING_DOC_NO,MESSAGE_ACTIVE_IND,MESSAGE_TYPE_CODE,MESSAGE_TRANSMISSION_MEDIUM_CODE,MESSAGE_STATUS_PRINT_ARCHIVING_MODE_CODE,OBJECT_KEY,MESSAGE_PARTNER_CODE,MESSAGE_STATUS_SPOOL_OUTPUT_DEVICE_CODE,MESSAGE_STATUS_SPOOL_REQUEST_NAME,CONDITION_TYPE_NAME,BILL_REUSABLE_LAST_DTM,BILL_NAST_COMP_KEY)
VALUES (src.BILLING_DOC_NO,src.SALES_DOC_CATEGORY_CODE,src.SHIPPING_CONDITIONS_CODE,src.SALES_DOC_CURRENCY_CODE,src.PAYMENT_METHOD_CODE,src.PAYMENT_TERMS_CODE,src.BILLING_HEADER_LAST_CHANGE_DATE,src.COMPANY_CODE,src.BILLING_HEADER_RECORD_CREATE_DATE,src.BILLING_HEADER_RECORD_CREATE_BY,src.BILLING_TYPE_CODE,src.BILLING_DATE,src.BILLING_CATEGORY_CODE,src.DOC_CONDITION_NO,src.ACCOUNT_ASSIGNMENT_GROUP_CODE,src.SOLD_TO_PARTY_CODE,src.PAYER_CODE,src.DISTRIBUTION_CHANNEL_CODE,src.SALES_ORG_CODE,src.SOLD_TO_PARTY_NAME,src.BILLING_HEADER_DIVISION_CODE,src.BILLING_HEADER_REF_DOC_NO,src.BILLING_DOC_CANCEL_CODE,src.CUSTOMER_GROUP_CODE,src.CUSTOMER_PRICE_GROUP_CODE,src.SHIP_TO_PARTY,src.BILL_TO_PARTY,src.SHIP_TO_PARTY_NAME,src.BILL_TO_PARTY_NAME,src.PAYER_NAME,src.CREDIT_CONTROL_AREA_DESC,src.PAYMENT_METHOD_DESC,src.DIVISION_NAME,src.BILLING_DOC_TYPE_DESC,src.SALES_ORGANISATION_NAME,src.CUSTOMER_ACCOUNT_ASSIGNMENT_GROUP_DESC,src.SHIPPING_CONDITION_DESC,src.DISTRIBUTION_CHANNEL_NAME,src.PAYMENT_TERM_DESC,src.INCOTERM_CODE,src.INCOTERM_DESTINATION_NAME,src.PAYMENT_REF_CODE,src.CREDIT_CONTROL_AREA_CODE,src.CANCELLED_BILLING_DOC_NO,src.MESSAGE_ACTIVE_IND,src.MESSAGE_TYPE_CODE,src.MESSAGE_TRANSMISSION_MEDIUM_CODE,src.MESSAGE_STATUS_PRINT_ARCHIVING_MODE_CODE,src.OBJECT_KEY,src.MESSAGE_PARTNER_CODE,src.MESSAGE_STATUS_SPOOL_OUTPUT_DEVICE_CODE,src.MESSAGE_STATUS_SPOOL_REQUEST_NAME,src.CONDITION_TYPE_NAME,src.BILL_REUSABLE_LAST_DTM,src.BILL_NAST_COMP_KEY);
END
